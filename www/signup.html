<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Sign Up</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">

    <link href="css/ratchet.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/jumbotron-narrow.css" rel="stylesheet">

    <link href="css/chromart.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="js/ie10-viewport-bug-workaround.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.19.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <!--<script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>-->


  </head>

  <body>

    <div class="container">
      <div class="header">
        <img src="img/logo.png" class="logo center" />
      </div>

      <div class="titleText">
        <p>Sign Up</p>
      </div>

      <div class="imageUpload">
        <form class="fileupload" name="fileupload" enctype="multipart/form-data" method="post">
          <fieldset class="fieldset">
            <input type="file" name="fileselect" class="fileselect"></input>
          </fieldset>
        </form>
      </div>

      <div>
        <form role="form">
          <div class="form-group">
            <input type="name" class="form-control" id="inputFullName" placeholder="Full Name">
          </div>
          <div class="form-group">
            <input type="email" class="form-control" id="inputEmail" placeholder="Email">
          </div>
          <div class="form-group">
            <input type="username" class="form-control" id="inputUsername" placeholder="Username">
          </div>
          <div class="form-group">
            <input type="password" class="form-control" id="inputPassword" placeholder="Password">
          </div>
          <button type="submit" class="btn blueButton">Continue</button>
        </form>
        <button type="button" class="btn btn-default toIndex">Go Back</button>
      </div>

      <div class="clear"></div>

    </div> <!-- /container -->


<script type="text/javascript">
    Parse.initialize("OmBCFAsCIuhnhzrCLtvKyGIdxQHYBW89XS3QqkvP", "mQK3VkWpDgGHoxDH0kroP1UFd7WPUbm0ZT2vzf21");

    $("form").on("submit", function(e) {
      e.preventDefault();

      var user = new Parse.User();

      user.set("fullname", $("#inputFullName").val());
      user.set("email", $("#inputEmail").val());
      user.set("username", $("#inputUsername").val());
      user.set("password", $("#inputPassword").val());
      //user.set("emailVerified", false);

      user.set("profileDescription", "");
      var serverUrl = 'https://api.parse.com/1/files/' + file.name;

      $.ajax({
        type: "POST",
        beforeSend: function(request) {
          request.setRequestHeader("X-Parse-Application-Id",
            'OmBCFAsCIuhnhzrCLtvKyGIdxQHYBW89XS3QqkvP');
          request.setRequestHeader("X-Parse-REST-API-Key",
            'zj1rLnIGUQZTCi4HrAYg6aJMErXTQJemsZ4vXw8w');
          request.setRequestHeader("Content-Type", file.type);
        },
        url: serverUrl,
        data: file,
        processData: false,
        contentType: false,
        dataType: 'json',
        success: function(data) {
          alert("File available at: " + data.url);
          user.set("profilePictureUrl", data.url);
          user.signUp(null, {
            success: function(object) {
              alert("Success!");
              Parse.User.logIn($("#inputUsername").val(), $("#inputPassword").val(), {
                success: function(user) {              
                  window.location.href = 'home.html';
                },
                error: function(user, error) {
                  alert("There was an error logging in. Please try again.");
                }
              })
            },
            error: function(model, error) {
              alert("There was an error signing up. Please try again.");
            }
          });
        },
        error: function(data) {
          var obj = jQuery.parseJSON(data);
          alert(obj.error);
          alert("error");
        }
      });

    });

    $(".toIndex").click(function() {
      window.location.href = 'index.html';
    });

    var file;

    // Set an event listener on the Choose File field.
    $('.fileselect').bind("change", function(e) {
      var files = e.target.files || e.dataTransfer.files;
      // Our file var now holds the selected file
      file = files[0];
    });

  </script>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
  </body>
</html>
